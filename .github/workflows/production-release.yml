name: PROD Release Workflow

on:
    workflow_dispatch:
        inputs:
            environment:
                description: "Target environment for production deployment"
                required: true
                default: "prod"
                type: choice
                options:
                    - prod
            ref:
                description: "Git ref (commit SHA, branch, or tag) to deploy - leave empty to deploy current branch latest commit"
                required: false
                type: string
                default: ""
            deploy_all:
                description: "Deploy all applications regardless of changes"
                required: false
                type: boolean
                default: false

concurrency:
    group: production-deploy-${{ inputs.environment }}
    cancel-in-progress: false

permissions:
    contents: read
    actions: read
    id-token: write

jobs:
    deploy-environment:
        name: Deploy to ${{ inputs.environment }}
        uses: ./.github/workflows/deploy.yml
        with:
            environment: ${{ inputs.environment }}
            ref: ${{ inputs.ref }}
            deploy_infrastructure: true
            deploy_all: ${{ inputs.deploy_all }}
        secrets: inherit
